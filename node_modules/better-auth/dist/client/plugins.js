import{atom as d}from"nanostores";function y(e){let t=e;return{newRole(i){return b(i)}}}function b(e){return{statements:e,authorize(t,i){for(let[s,o]of Object.entries(t)){let r=e[s];return r?(i==="OR"?o.some(n=>r.includes(n)):o.every(n=>r.includes(n)))?{success:!0}:{success:!1,error:`Unauthorized to access resource "${s}"`}:{success:!1,error:`You are not allowed to access resource: ${s}`}}return{success:!1,error:"Not authorized"}}}}var T={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]},f=y(T),h=f.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"]}),P=f.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]}),O=f.newRole({organization:[],member:[],invitation:[]});import{createFetch as ce}from"@better-fetch/fetch";var m=Object.create(null),u=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?m:globalThis),A=new Proxy(m,{get(e,t){return u()[t]??m[t]},has(e,t){let i=u();return t in i||t in m},set(e,t,i){let s=u(!0);return s[t]=i,!0},deleteProperty(e,t){if(!t)return!1;let i=u(!0);return delete i[t],!0},ownKeys(){let e=u(!0);return Object.keys(e)}});function x(e){return e?e!=="false":!1}var R=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var N=R==="test"||x(A.TEST);import"nanostores";import"@better-fetch/fetch";import{atom as te}from"nanostores";import"@better-fetch/fetch";import{atom as w,onMount as C}from"nanostores";var c=(e,t,i,s)=>{let o=w({data:null,error:null,isPending:!0,isRefetching:!1}),r=()=>{let n=typeof s=="function"?s({data:o.get().data,error:o.get().error,isPending:o.get().isPending}):s;return i(t,{...n,async onSuccess(l){o.set({data:l.data,error:null,isPending:!1,isRefetching:!1}),await n?.onSuccess?.(l)},async onError(l){o.set({error:l.error,data:null,isPending:!1,isRefetching:!1}),await n?.onError?.(l)},async onRequest(l){let p=o.get();o.set({isPending:p.data===null,data:p.data,error:null,isRefetching:!0}),await n?.onRequest?.(l)}})};e=Array.isArray(e)?e:[e];let a=!1;for(let n of e)n.subscribe(()=>{a?r():C(o,()=>(r(),a=!0,()=>{o.off(),n.off()}))});return o};var Ee=e=>{let t=d(!1),i=d(!1),s=d(!1),o={admin:h,member:O,owner:P,...e?.roles};return{id:"organization",$InferServerPlugin:{},getActions:r=>({$Infer:{ActiveOrganization:{},Organization:{},Invitation:{},Member:{}},organization:{checkRolePermission:a=>{let n=o[a.role];return n?(n?.authorize(a.permission)).success:!1}}}),getAtoms:r=>{let a=c(t,"/organization/list",r,{method:"GET"}),n=c([i],"/organization/get-full-organization",r,()=>({method:"GET"})),l=c([s],"/organization/get-active-member",r,{method:"GET"});return{$listOrg:t,$activeOrgSignal:i,$activeMemberSignal:s,activeOrganization:n,listOrganizations:a,activeMember:l}},atomListeners:[{matcher(r){return r==="/organization/create"||r==="/organization/delete"},signal:"$listOrg"},{matcher(r){return r.startsWith("/organization")},signal:"$activeOrgSignal"},{matcher(r){return r.includes("/organization/update-member-role")},signal:"$activeMemberSignal"}]}};var Ie=()=>({id:"username",$InferServerPlugin:{}});import{WebAuthnError as v,startAuthentication as B,startRegistration as k}from"@simplewebauthn/browser";import{atom as F}from"nanostores";var E=(e,{$listPasskeys:t})=>({signIn:{passkey:async(o,r)=>{let a=await e("/passkey/generate-authenticate-options",{method:"POST",body:{email:o?.email}});if(!a.data)return a;try{let n=await B(a.data,o?.autoFill||!1),l=await e("/passkey/verify-authentication",{body:{response:n},...o?.fetchOptions,...r,method:"POST"});if(!l.data)return l}catch{return{data:null,error:{message:"auth cancelled",status:400,statusText:"BAD_REQUEST"}}}}},passkey:{addPasskey:async(o,r)=>{let a=await e("/passkey/generate-register-options",{method:"GET"});if(!a.data)return a;try{let n=await k(a.data),l=await e("/passkey/verify-registration",{...o?.fetchOptions,...r,body:{response:n,name:o?.name},method:"POST"});if(!l.data)return l;t.set(Math.random())}catch(n){return n instanceof v?n.code==="ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED"?{data:null,error:{message:"previously registered",status:400,statusText:"BAD_REQUEST"}}:n.code==="ERROR_CEREMONY_ABORTED"?{data:null,error:{message:"registration cancelled",status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:n.message,status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:n instanceof Error?n.message:"unknown error",status:500,statusText:"INTERNAL_SERVER_ERROR"}}}}},$Infer:{}}),Ge=()=>{let e=F();return{id:"passkey",$InferServerPlugin:{},getActions:t=>E(t,{$listPasskeys:e}),getAtoms(t){return{listPasskeys:c(e,"/passkey/list-user-passkeys",t,{method:"GET"}),$listPasskeys:e}},pathMethods:{"/passkey/register":"POST","/passkey/authenticate":"POST"},atomListeners:[{matcher(t){return t==="/passkey/verify-registration"||t==="/passkey/delete-passkey"},signal:"_listPasskeys"}]}};var Ne=(e={redirect:!0,twoFactorPage:"/"})=>({id:"two-factor",$InferServerPlugin:{},atomListeners:[{matcher:t=>t.startsWith("/two-factor/"),signal:"$sessionSignal"}],pathMethods:{"/two-factor/disable":"POST","/two-factor/enable":"POST","/two-factor/send-otp":"POST","/two-factor/generate-backup-codes":"POST"},fetchPlugins:[{id:"two-factor",name:"two-factor",hooks:{async onSuccess(t){t.data?.twoFactorRedirect&&(e.redirect||e.twoFactorPage)&&typeof window<"u"&&(window.location.href=e.twoFactorPage)}}}]});var qe=()=>({id:"magic-link",$InferServerPlugin:{}});var De=()=>({id:"phoneNumber",$InferServerPlugin:{},atomListeners:[{matcher(e){return e==="/phone-number/update"||e==="/phone-number/verify"},signal:"$sessionSignal"}]});var Ke=()=>({id:"anonymous",$InferServerPlugin:{},pathMethods:{"/sign-in/anonymous":"POST"}});var Ve=e=>({id:"additional-fields-client",$InferServerPlugin:{}});var Xe=()=>({id:"better-auth-client",$InferServerPlugin:{},pathMethods:{"/admin/list-users":"GET"}});var Ze=()=>({id:"generic-oauth-client",$InferServerPlugin:{}});var tt=()=>({id:"better-auth-client",$InferServerPlugin:{}});var rt=()=>({id:"multi-session",$InferServerPlugin:{},atomListeners:[{matcher(e){return e==="/multi-session/set-active"},signal:"$sessionSignal"}]});var st=()=>({id:"email-otp",$InferServerPlugin:{}});var g=!1,at=e=>({id:"one-tap",getActions:(t,i)=>({oneTap:async(s,o)=>{if(g){console.warn("A Google One Tap request is already in progress. Please wait.");return}g=!0;try{if(typeof window>"u"||!window.document){console.warn("Google One Tap is only available in browser environments");return}let{autoSelect:r,cancelOnTapOutside:a,context:n}=s??{},l=n??e.context??"signin";await U(),await new Promise(p=>{window.google?.accounts.id.initialize({client_id:e.clientId,callback:async S=>{await t("/one-tap/callback",{method:"POST",body:{idToken:S.credential},...s?.fetchOptions,...o}),(!s?.fetchOptions&&!o||s?.callbackURL)&&(window.location.href=s?.callbackURL??"/"),p()},auto_select:r,cancel_on_tap_outside:a,context:l}),window.google?.accounts.id.prompt()})}catch(r){throw console.error("Error during Google One Tap flow:",r),r}finally{g=!1}}}),getAtoms(t){return{}}}),U=()=>new Promise(e=>{if(window.googleScriptInitialized){e();return}let t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{window.googleScriptInitialized=!0,e()},document.head.appendChild(t)});export{Xe as adminClient,Ke as anonymousClient,st as emailOTPClient,Ze as genericOAuthClient,E as getPasskeyActions,Ve as inferAdditionalFields,tt as jwtClient,qe as magicLinkClient,rt as multiSessionClient,at as oneTapClient,Ee as organizationClient,Ge as passkeyClient,De as phoneNumberClient,Ne as twoFactorClient,Ie as usernameClient};
