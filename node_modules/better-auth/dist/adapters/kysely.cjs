"use strict";var k=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var M=(e,i)=>{for(var u in i)k(e,u,{get:i[u],enumerable:!0})},U=(e,i,u,m)=>{if(i&&typeof i=="object"||typeof i=="function")for(let y of L(i))!P.call(e,y)&&y!==u&&k(e,y,{get:()=>i[y],enumerable:!(m=V(i,y))||m.enumerable});return e};var j=e=>U(k({},"__esModule",{value:!0}),e);var Z={};M(Z,{createKyselyAdapter:()=>I,kyselyAdapter:()=>D});module.exports=j(Z);var T=require("kysely"),x=require("kysely");function S(e){if("dialect"in e)return S(e.dialect);if("createDriver"in e){if(e instanceof x.SqliteDialect)return"sqlite";if(e instanceof x.MysqlDialect)return"mysql";if(e instanceof x.PostgresDialect)return"postgres";if(e instanceof T.MssqlDialect)return"mssql"}return"aggregate"in e?"sqlite":"getConnection"in e?"mysql":"connect"in e?"postgres":null}var I=async e=>{let i=e.database;if("db"in i)return{kysely:i.db,databaseType:i.type};if("dialect"in i)return{kysely:new T.Kysely({dialect:i.dialect}),databaseType:i.type};let u,m=S(i);return"createDriver"in i&&(u=i),"aggregate"in i&&(u=new x.SqliteDialect({database:i})),"getConnection"in i&&(u=new x.MysqlDialect(i)),"connect"in i&&(u=new x.PostgresDialect({pool:i})),{kysely:u?new T.Kysely({dialect:u}):null,databaseType:m}};var c=require("zod"),Y=c.z.object({id:c.z.string(),providerId:c.z.string(),accountId:c.z.string(),userId:c.z.string(),accessToken:c.z.string().nullish(),refreshToken:c.z.string().nullish(),idToken:c.z.string().nullish(),expiresAt:c.z.date().nullish(),password:c.z.string().nullish()}),ee=c.z.object({id:c.z.string(),email:c.z.string().transform(e=>e.toLowerCase()),emailVerified:c.z.boolean().default(!1),name:c.z.string(),image:c.z.string().nullish(),createdAt:c.z.date().default(new Date),updatedAt:c.z.date().default(new Date)}),te=c.z.object({id:c.z.string(),userId:c.z.string(),expiresAt:c.z.date(),ipAddress:c.z.string().nullish(),userAgent:c.z.string().nullish()}),re=c.z.object({id:c.z.string(),value:c.z.string(),createdAt:c.z.date(),expiresAt:c.z.date(),identifier:c.z.string()});var K=require("nanoid");var F=Object.create(null),v=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?F:globalThis),E=new Proxy(F,{get(e,i){return v()[i]??F[i]},has(e,i){let u=v();return i in u||i in F},set(e,i,u){let m=v(!0);return m[i]=u,!0},deleteProperty(e,i){if(!i)return!1;let u=v(!0);return delete u[i],!0},ownKeys(){let e=v(!0);return Object.keys(e)}});function C(e){return e?e!=="false":!1}var H=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var W=H==="test"||C(E.TEST);var N=e=>{let i=e.plugins?.reduce((w,n)=>{let t=n.schema;if(!t)return w;for(let[s,d]of Object.entries(t))w[s]={fields:{...w[s]?.fields,...d.fields},modelName:d.modelName||s};return w},{}),u=e.rateLimit?.storage==="database",m={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:y,session:A,account:h,...b}=i||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...y?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...A?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},expiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.expiresAt||"expiresAt"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},...h?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"}},order:4},...b,...u?m:{}}};var $=require("zod");var R=require("consola"),q=["info","success","warn","error","debug"];function _(e,i){return q.indexOf(i)<=q.indexOf(e)}var J=(0,R.createConsola)({formatOptions:{date:!1,colors:!0,compact:!0},defaults:{tag:"Better Auth"}}),B=e=>{let i=e?.disabled!==!0,u=e?.level??"error",m=(y,A,h=[])=>{if(!(!i||!_(u,y))){if(!e||typeof e.log!="function"){J[y]("",A,...h);return}e.log(y==="success"?"info":y,A,h)}};return Object.fromEntries(q.map(y=>[y,(...[A,...h])=>m(y,A,h)]))},Le=B();var z=(e,i,u)=>{let m=N(i);function y(n,t){if(t==="id")return t;let s=m[n].fields[t];return s||console.log("Field not found",n,t),s.fieldName||t}function A(n,t,s){let{type:d="sqlite"}=u||{},o=m[t].fields[s];return o.type==="boolean"&&d==="sqlite"?n?1:0:o.type==="date"&&n&&n instanceof Date&&d==="sqlite"?n.toISOString():n}function h(n,t,s){let{type:d="sqlite"}=u||{},o=m[t].fields[s];return o.type==="boolean"&&d==="sqlite"&&n!==null?n===1:o.type==="date"&&n?new Date(n):n}function b(n){return m[n].modelName}let w=u?.generateId!==!1;return{transformInput(n,t){let s=n.id&&w?{id:u?.generateId?u.generateId():n.id}:{};for(let d in n){let o=m[t].fields[d];o&&(s[o.fieldName||d]=A(n[d],t,d))}return s},transformOutput(n,t,s=[]){if(!n)return null;let d=n.id?s.length===0||s.includes("id")?{id:n.id}:{}:{},o=m[t].fields;for(let r in o){if(s.length&&!s.includes(r))continue;let a=o[r];a&&(d[r]=h(n[a.fieldName||r],t,r))}return d},convertWhereClause(n,t){if(!t)return{and:null,or:null};let s={and:[],or:[]};return t.forEach(d=>{let{field:o,value:r,operator:a="=",connector:f="AND"}=d,l=y(n,o),g=p=>a.toLowerCase()==="in"?p(l,"in",Array.isArray(r)?r:[r]):a==="contains"?p(l,"like",`%${r}%`):a==="starts_with"?p(l,"like",`${r}%`):a==="ends_with"?p(l,"like",`%${r}`):a==="eq"?p(l,"=",r):a==="ne"?p(l,"<>",r):a==="gt"?p(l,">",r):a==="gte"?p(l,">=",r):a==="lt"?p(l,"<",r):a==="lte"?p(l,"<=",r):p(l,a,r);f==="OR"?s.or.push(g):s.and.push(g)}),{and:s.and.length?s.and:null,or:s.or.length?s.or:null}},async withReturning(n,t,s,d){let o;if(u?.type!=="mysql")o=await t.returningAll().executeTakeFirst();else{await t.execute();let r=n.id?"id":d[0].field?d[0].field:"id",a=n[r]||d[0].value;o=await e.selectFrom(b(s)).selectAll().where(y(s,r),"=",a).executeTakeFirst()}return o},getModelName:b,getField:y}},D=(e,i)=>u=>{let{transformInput:m,withReturning:y,transformOutput:A,convertWhereClause:h,getModelName:b,getField:w}=z(e,u,i);return{id:"kysely",async create(n){let{model:t,data:s,select:d}=n,o=m(s,t),r=e.insertInto(b(t)).values(o);return A(await y(o,r,t,[]),t,d)},async findOne(n){let{model:t,where:s,select:d}=n,{and:o,or:r}=h(t,s),a=e.selectFrom(b(t)).selectAll();o&&(a=a.where(l=>l.and(o.map(g=>g(l))))),r&&(a=a.where(l=>l.or(r.map(g=>g(l)))));let f=await a.executeTakeFirst();return f?A(f,t,d):null},async findMany(n){let{model:t,where:s,limit:d,offset:o,sortBy:r}=n,{and:a,or:f}=h(t,s),l=e.selectFrom(b(t));a&&(l=l.where(p=>p.and(a.map(O=>O(p))))),f&&(l=l.where(p=>p.or(f.map(O=>O(p))))),l=l.limit(d||100),o&&(l=l.offset(o)),r&&(l=l.orderBy(w(t,r.field),r.direction));let g=await l.selectAll().execute();return g?g.map(p=>A(p,t)):[]},async update(n){let{model:t,where:s,update:d}=n,{and:o,or:r}=h(t,s),a=m(d,t),f=e.updateTable(b(t)).set(a);return o&&(f=f.where(l=>l.and(o.map(g=>g(l))))),r&&(f=f.where(l=>l.or(r.map(g=>g(l))))),A(await y(a,f,t,s),t)},async updateMany(n){let{model:t,where:s,update:d}=n,{and:o,or:r}=h(t,s),a=m(d,t),f=e.updateTable(b(t)).set(a);return o&&(f=f.where(g=>g.and(o.map(p=>p(g))))),r&&(f=f.where(g=>g.or(r.map(p=>p(g))))),(await f.execute()).length},async delete(n){let{model:t,where:s}=n,{and:d,or:o}=h(t,s),r=e.deleteFrom(b(t));d&&(r=r.where(a=>a.and(d.map(f=>f(a))))),o&&(r=r.where(a=>a.or(o.map(f=>f(a))))),await r.execute()},async deleteMany(n){let{model:t,where:s}=n,{and:d,or:o}=h(t,s),r=e.deleteFrom(b(t));return d&&(r=r.where(a=>a.and(d.map(f=>f(a))))),o&&(r=r.where(a=>a.or(o.map(f=>f(a))))),(await r.execute()).length},options:i}};0&&(module.exports={createKyselyAdapter,kyselyAdapter});
