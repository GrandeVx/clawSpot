"use strict";var x=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var D=(e,n)=>{for(var l in n)x(e,l,{get:n[l],enumerable:!0})},R=(e,n,l,u)=>{if(n&&typeof n=="object"||typeof n=="function")for(let c of q(n))!S.call(e,c)&&c!==l&&x(e,c,{get:()=>n[c],enumerable:!(u=N(n,c))||u.enumerable});return e};var B=e=>R(x({},"__esModule",{value:!0}),e);var _={};D(_,{prismaAdapter:()=>H});module.exports=B(_);var s=require("zod"),Z=s.z.object({id:s.z.string(),providerId:s.z.string(),accountId:s.z.string(),userId:s.z.string(),accessToken:s.z.string().nullish(),refreshToken:s.z.string().nullish(),idToken:s.z.string().nullish(),expiresAt:s.z.date().nullish(),password:s.z.string().nullish()}),G=s.z.object({id:s.z.string(),email:s.z.string().transform(e=>e.toLowerCase()),emailVerified:s.z.boolean().default(!1),name:s.z.string(),image:s.z.string().nullish(),createdAt:s.z.date().default(new Date),updatedAt:s.z.date().default(new Date)}),Q=s.z.object({id:s.z.string(),userId:s.z.string(),expiresAt:s.z.date(),ipAddress:s.z.string().nullish(),userAgent:s.z.string().nullish()}),X=s.z.object({id:s.z.string(),value:s.z.string(),createdAt:s.z.date(),expiresAt:s.z.date(),identifier:s.z.string()});var P=require("nanoid");var b=Object.create(null),A=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?b:globalThis),M=new Proxy(b,{get(e,n){return A()[n]??b[n]},has(e,n){let l=A();return n in l||n in b},set(e,n,l){let u=A(!0);return u[n]=l,!0},deleteProperty(e,n){if(!n)return!1;let l=A(!0);return delete l[n],!0},ownKeys(){let e=A(!0);return Object.keys(e)}});function V(e){return e?e!=="false":!1}var L=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var C=L==="test"||V(M.TEST);var w=e=>{let n=e.plugins?.reduce((i,f)=>{let o=f.schema;if(!o)return i;for(let[t,d]of Object.entries(o))i[t]={fields:{...i[t]?.fields,...d.fields},modelName:d.modelName||t};return i},{}),l=e.rateLimit?.storage==="database",u={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:c,session:m,account:p,...a}=n||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...c?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...m?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},expiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.expiresAt||"expiresAt"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},...p?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"}},order:4},...a,...l?u:{}}};var U=require("zod");var F=require("kysely"),v=require("kysely");var O=require("consola"),T=["info","success","warn","error","debug"];function K(e,n){return T.indexOf(n)<=T.indexOf(e)}var E=(0,O.createConsola)({formatOptions:{date:!1,colors:!0,compact:!0},defaults:{tag:"Better Auth"}}),I=e=>{let n=e?.disabled!==!0,l=e?.level??"error",u=(c,m,p=[])=>{if(!(!n||!K(l,c))){if(!e||typeof e.log!="function"){E[c]("",m,...p);return}e.log(c==="success"?"info":c,m,p)}};return Object.fromEntries(T.map(c=>[c,(...[m,...p])=>u(c,m,p)]))},Ue=I();var W=(e,n)=>{let l=w(n);function u(a,i){return i==="id"?i:l[a].fields[i].fieldName||i}function c(a){switch(a){case"starts_with":return"startsWith";case"ends_with":return"endsWith";default:return a}}function m(a){return l[a].modelName}let p=e?.generateId!==!1;return{transformInput(a,i){let f=a.id&&p?{id:e?.generateId?e.generateId():a.id}:{};for(let o in a){let t=l[i].fields[o];t&&(f[t.fieldName||o]=a[o])}return f},transformOutput(a,i,f=[]){if(!a)return null;let o=a.id||a._id?f.length===0||f.includes("id")?{id:a.id}:{}:{},t=l[i].fields;for(let d in t){if(f.length&&!f.includes(d))continue;let r=t[d];r&&(o[d]=a[r.fieldName||d])}return o},convertWhereClause(a,i){if(!i)return{};if(i.length===1){let r=i[0];return r?{[u(a,r.field)]:r.operator==="eq"||!r.operator?r.value:{[c(r.operator)]:r.value}}:void 0}let f=i.filter(r=>r.connector==="AND"||!r.connector),o=i.filter(r=>r.connector==="OR"),t=f.map(r=>({[u(a,r.field)]:r.operator==="eq"||!r.operator?r.value:{[c(r.operator)]:r.value}})),d=o.map(r=>({[u(a,r.field)]:{[r.operator||"eq"]:r.value}}));return{AND:t.length?t:void 0,OR:d.length?d:void 0}},convertSelect:(a,i)=>{if(!(!a||!i))return a.reduce((f,o)=>({...f,[u(i,o)]:!0}),{})},getModelName:m,getField:u}},H=(e,n)=>l=>{let u=e,{transformInput:c,transformOutput:m,convertWhereClause:p,convertSelect:a,getModelName:i,getField:f}=W(n,l);return{id:"prisma",async create(o){let{model:t,data:d,select:r}=o,y=c(d,t),g=await u[i(t)].create({data:y,select:a(r,t)});return m(g,t,r)},async findOne(o){let{model:t,where:d,select:r}=o,y=p(t,d),g=await u[i(t)].findFirst({where:y,select:a(r,t)});return m(g,t,r)},async findMany(o){let{model:t,where:d,limit:r,offset:y,sortBy:g}=o,h=p(t,d);return(await u[i(t)].findMany({where:h,take:r||100,skip:y||0,orderBy:g?.field?{[f(t,g.field)]:g.direction==="desc"?"desc":"asc"}:void 0})).map(k=>m(k,t))},async update(o){let{model:t,where:d,update:r}=o,y=p(t,d),g=c(r,t),h=await u[i(t)].update({where:y,data:g});return m(h,t)},async updateMany(o){let{model:t,where:d,update:r}=o,y=p(t,d),g=c(r,t),h=await u[i(t)].updateMany({where:y,data:g});return h?h.count:0},async delete(o){let{model:t,where:d}=o,r=p(t,d);try{await u[i(t)].delete({where:r})}catch{}},async deleteMany(o){let{model:t,where:d}=o,r=p(t,d),y=await u[i(t)].deleteMany({where:r});return y?y.count:0},options:n}};0&&(module.exports={prismaAdapter});
