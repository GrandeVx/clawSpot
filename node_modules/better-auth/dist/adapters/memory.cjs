"use strict";var A=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var N=(e,n)=>{for(var l in n)A(e,l,{get:n[l],enumerable:!0})},q=(e,n,l,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of k(n))!I.call(e,r)&&r!==l&&A(e,r,{get:()=>n[r],enumerable:!(o=O(n,r))||o.enumerable});return e};var D=e=>q(A({},"__esModule",{value:!0}),e);var C={};N(C,{memoryAdapter:()=>K});module.exports=D(C);var s=require("zod"),H=s.z.object({id:s.z.string(),providerId:s.z.string(),accountId:s.z.string(),userId:s.z.string(),accessToken:s.z.string().nullish(),refreshToken:s.z.string().nullish(),idToken:s.z.string().nullish(),expiresAt:s.z.date().nullish(),password:s.z.string().nullish()}),$=s.z.object({id:s.z.string(),email:s.z.string().transform(e=>e.toLowerCase()),emailVerified:s.z.boolean().default(!1),name:s.z.string(),image:s.z.string().nullish(),createdAt:s.z.date().default(new Date),updatedAt:s.z.date().default(new Date)}),J=s.z.object({id:s.z.string(),userId:s.z.string(),expiresAt:s.z.date(),ipAddress:s.z.string().nullish(),userAgent:s.z.string().nullish()}),z=s.z.object({id:s.z.string(),value:s.z.string(),createdAt:s.z.date(),expiresAt:s.z.date(),identifier:s.z.string()});var S=require("nanoid");var g=Object.create(null),y=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?g:globalThis),R=new Proxy(g,{get(e,n){return y()[n]??g[n]},has(e,n){let l=y();return n in l||n in g},set(e,n,l){let o=y(!0);return o[n]=l,!0},deleteProperty(e,n){if(!n)return!1;let l=y(!0);return delete l[n],!0},ownKeys(){let e=y(!0);return Object.keys(e)}});function B(e){return e?e!=="false":!1}var V=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var M=V==="test"||B(R.TEST);var h=e=>{let n=e.plugins?.reduce((i,u)=>{let c=u.schema;if(!c)return i;for(let[a,p]of Object.entries(c))i[a]={fields:{...i[a]?.fields,...p.fields},modelName:p.modelName||a};return i},{}),l=e.rateLimit?.storage==="database",o={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:r,session:f,account:t,...d}=n||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...r?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...f?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},expiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.expiresAt||"expiresAt"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},...t?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"}},order:4},...d,...l?o:{}}};var L=require("zod");var v=require("kysely"),b=require("kysely");var T=require("consola"),x=["info","success","warn","error","debug"];function U(e,n){return x.indexOf(n)<=x.indexOf(e)}var j=(0,T.createConsola)({formatOptions:{date:!1,colors:!0,compact:!0},defaults:{tag:"Better Auth"}}),F=e=>{let n=e?.disabled!==!0,l=e?.level??"error",o=(r,f,t=[])=>{if(!(!n||!U(l,r))){if(!e||typeof e.log!="function"){j[r]("",f,...t);return}e.log(r==="success"?"info":r,f,t)}};return Object.fromEntries(x.map(r=>[r,(...[f,...t])=>o(r,f,t)]))},Me=F();var E=e=>{let n=h(e);function l(o,r){return r==="id"?r:n[o].fields[r].fieldName||r}return{transformInput(o,r){let f=o.id?{id:o.id}:{};for(let t in o){let d=n[r].fields[t];d&&(f[d.fieldName||t]=o[t])}return f},transformOutput(o,r,f=[]){if(!o)return null;let t=o.id||o._id?f.length===0||f.includes("id")?{id:o.id}:{}:{},d=n[r].fields;for(let i in d){if(f.length&&!f.includes(i))continue;let u=d[i];u&&(t[i]=o[u.fieldName||i])}return t},convertWhereClause(o,r,f){return r.filter(t=>o.every(d=>{let{field:i,value:u,operator:c}=d,a=l(f,i);if(c==="in"){if(!Array.isArray(u))throw new Error("Value must be an array");return u.includes(t[a])}else return c==="contains"?t[a].includes(u):c==="starts_with"?t[a].startsWith(u):c==="ends_with"?t[a].endsWith(u):t[a]===u}))},getField:l}},K=e=>n=>{let{transformInput:l,transformOutput:o,convertWhereClause:r,getField:f}=E(n);return{id:"memory",create:async({model:t,data:d})=>{let i=l(d,t);return e[t].push(i),o(i,t)},findOne:async({model:t,where:d,select:i})=>{let u=e[t],a=r(d,u,t)[0]||null;return o(a,t,i)},findMany:async({model:t,where:d,sortBy:i,limit:u,offset:c})=>{let a=e[t];return d&&(a=r(d,a,t)),i&&(a=a.sort((p,w)=>{let m=f(t,i.field);return i.direction==="asc"?p[m]>w[m]?1:-1:p[m]<w[m]?1:-1})),c!==void 0&&(a=a.slice(c)),u!==void 0&&(a=a.slice(0,u)),a.map(p=>o(p,t))},update:async({model:t,where:d,update:i})=>{let u=e[t],c=r(d,u,t);return c.forEach(a=>{Object.assign(a,l(i,t))}),o(c[0],t)},delete:async({model:t,where:d})=>{let i=e[t],u=r(d,i,t);e[t]=i.filter(c=>!u.includes(c))},deleteMany:async({model:t,where:d})=>{let i=e[t],u=r(d,i,t),c=0;return e[t]=i.filter(a=>u.includes(a)?(c++,!1):!u.includes(a)),c},updateMany(t){let{model:d,where:i,update:u}=t,c=e[d],a=r(i,c,d);return a.forEach(p=>{Object.assign(p,u)}),a[0]||null}}};0&&(module.exports={memoryAdapter});
