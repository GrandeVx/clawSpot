"use strict";var x=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var M=(e,t)=>{for(var n in t)x(e,n,{get:t[n],enumerable:!0})},G=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of H(t))!N.call(e,r)&&r!==n&&x(e,r,{get:()=>t[r],enumerable:!(s=V(t,r))||s.enumerable});return e};var z=e=>G(x({},"__esModule",{value:!0}),e);var te={};M(te,{createAuthClient:()=>ee});module.exports=z(te);var d=require("vue");function X(e){let t=(0,d.getCurrentInstance)();if(t&&t.proxy){let n=t.proxy;("_nanostores"in n?n._nanostores:n._nanostores=[]).push(e)}}function w(e){let t=(0,d.shallowRef)(),n=e.subscribe(s=>{t.value=s});return(0,d.getCurrentScope)()&&(0,d.onScopeDispose)(n),process.env.NODE_ENV!=="production"?(X(e),(0,d.readonly)(t)):t}var $=require("@better-fetch/fetch");var b=Object.create(null),y=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?b:globalThis),g=new Proxy(b,{get(e,t){return y()[t]??b[t]},has(e,t){let n=y();return t in n||t in b},set(e,t,n){let s=y(!0);return s[t]=n,!0},deleteProperty(e,t){if(!t)return!1;let n=y(!0);return delete n[t],!0},ownKeys(){let e=y(!0);return Object.keys(e)}});function K(e){return e?e!=="false":!1}var Q=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var oe=Q==="test"||K(g.TEST);var O=class extends Error{constructor(t,n){super(t),this.name="BetterAuthError",this.message=t,this.cause=n,this.stack=""}};function Z(e){try{return new URL(e).pathname!=="/"}catch{throw new O(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function F(e,t="/api/auth"){return Z(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}function B(e,t){if(e)return F(e,t);let n=g.BETTER_AUTH_URL||g.NEXT_PUBLIC_BETTER_AUTH_URL||g.PUBLIC_BETTER_AUTH_URL||g.NUXT_PUBLIC_BETTER_AUTH_URL||g.NUXT_PUBLIC_AUTH_URL||(g.BASE_URL!=="/"?g.BASE_URL:void 0);if(n)return F(n,t);if(typeof window<"u"&&window.location)return F(window.location.origin,t)}var Pe=require("nanostores");var ue=require("@better-fetch/fetch"),L={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},C={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var _=require("nanostores");var pe=require("@better-fetch/fetch"),A=require("nanostores"),E=(e,t,n,s)=>{let r=(0,A.atom)({data:null,error:null,isPending:!0,isRefetching:!1}),p=()=>{let a=typeof s=="function"?s({data:r.get().data,error:r.get().error,isPending:r.get().isPending}):s;return n(t,{...a,async onSuccess(l){r.set({data:l.data,error:null,isPending:!1,isRefetching:!1}),await a?.onSuccess?.(l)},async onError(l){r.set({error:l.error,data:null,isPending:!1,isRefetching:!1}),await a?.onError?.(l)},async onRequest(l){let i=r.get();r.set({isPending:i.data===null,data:i.data,error:null,isRefetching:!0}),await a?.onRequest?.(l)}})};e=Array.isArray(e)?e:[e];let f=!1;for(let a of e)a.subscribe(()=>{f?p():(0,A.onMount)(r,()=>(p(),f=!0,()=>{r.off(),a.off()}))});return r};function I(e){let t=(0,_.atom)(!1);return{session:E(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var k=e=>{let t="credentials"in Request.prototype,n=B(e?.baseURL),s=e?.plugins?.flatMap(o=>o.fetchPlugins).filter(o=>o!==void 0)||[],r=(0,$.createFetch)({baseURL:n,...t?{credentials:"include"}:{},method:"GET",...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...s]:[L,C,...e?.fetchOptions?.plugins||[],...s]}),{$sessionSignal:p,session:f}=I(r),a=e?.plugins||[],l={},i={$sessionSignal:p,session:f},c={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST"},u=[{signal:"$sessionSignal",matcher(o){return o==="/sign-out"||o==="/update-user"||o.startsWith("/sign-in")||o.startsWith("/sign-up")}}];for(let o of a)o.getAtoms&&Object.assign(i,o.getAtoms?.(r)),o.pathMethods&&Object.assign(c,o.pathMethods),o.atomListeners&&u.push(...o.atomListeners);let m={notify:o=>{i[o].set(!i[o].get())},listen:(o,h)=>{i[o].subscribe(h)},atoms:i};for(let o of a)o.getActions&&Object.assign(l,o.getActions?.(r,m));return{pluginsActions:l,pluginsAtoms:i,pluginPathMethods:c,atomListeners:u,$fetch:r,$store:m}};function W(e){return e.charAt(0).toUpperCase()+e.slice(1)}function J(e,t,n){let s=t[e],{fetchOptions:r,query:p,...f}=n||{};return s||(r?.method?r.method:f&&Object.keys(f).length>0?"POST":"GET")}function j(e,t,n,s,r){function p(f=[]){return new Proxy(function(){},{get(a,l){let i=[...f,l],c=e;for(let u of i)if(c&&typeof c=="object"&&u in c)c=c[u];else{c=void 0;break}return typeof c=="function"?c:p(i)},apply:async(a,l,i)=>{let c="/"+f.map(U=>U.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)).join("/"),u=i[0]||{},m=i[1]||{},{query:o,fetchOptions:h,...P}=u,R={...m,...h},v=J(c,n,u);return await t(c,{...R,body:v==="GET"?void 0:{...P,...R?.body||{}},query:o||R?.query,method:v,async onSuccess(U){await R?.onSuccess?.(U);let S=r?.find(D=>D.matcher(c));if(!S)return;let T=s[S.signal];if(!T)return;let q=T.get();setTimeout(()=>{T.set(!q)},10)}})}})}return p()}function Y(e){return`use${W(e)}`}function ee(e){let{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:s,$fetch:r,$store:p,atomListeners:f}=k(e),a={};for(let[u,m]of Object.entries(s))a[Y(u)]=()=>w(m);function l(u){if(u){let m=w(s.$sessionSignal),o=e?.fetchOptions?.baseURL||e?.baseURL,h=o?new URL(o).pathname:"/api/auth";return u(`${h}/get-session`,{ref:m}).then(P=>({data:P.data,isPending:!1,error:P.error}))}return a.useSession()}let i={...n,...a,useSession:l,$fetch:r,$store:p};return j(i,r,t,s,f)}0&&(module.exports={createAuthClient});
