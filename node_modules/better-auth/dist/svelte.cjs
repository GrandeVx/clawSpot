"use strict";var U=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var G=(e,t)=>{for(var r in t)U(e,r,{get:t[r],enumerable:!0})},D=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of H(t))!M.call(e,n)&&n!==r&&U(e,n,{get:()=>t[n],enumerable:!(s=q(t,n))||s.enumerable});return e};var N=e=>D(U({},"__esModule",{value:!0}),e);var Z={};G(Z,{createAuthClient:()=>K});module.exports=N(Z);var E=require("@better-fetch/fetch");var P=Object.create(null),g=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?P:globalThis),p=new Proxy(P,{get(e,t){return g()[t]??P[t]},has(e,t){let r=g();return t in r||t in P},set(e,t,r){let s=g(!0);return s[t]=r,!0},deleteProperty(e,t){if(!t)return!1;let r=g(!0);return delete r[t],!0},ownKeys(){let e=g(!0);return Object.keys(e)}});function V(e){return e?e!=="false":!1}var z=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var Y=z==="test"||V(p.TEST);var A=class extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}};function X(e){try{return new URL(e).pathname!=="/"}catch{throw new A(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function S(e,t="/api/auth"){return X(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}function F(e,t){if(e)return S(e,t);let r=p.BETTER_AUTH_URL||p.NEXT_PUBLIC_BETTER_AUTH_URL||p.PUBLIC_BETTER_AUTH_URL||p.NUXT_PUBLIC_BETTER_AUTH_URL||p.NUXT_PUBLIC_AUTH_URL||(p.BASE_URL!=="/"?p.BASE_URL:void 0);if(r)return S(r,t);if(typeof window<"u"&&window.location)return S(window.location.origin,t)}var pe=require("nanostores");var se=require("@better-fetch/fetch"),w={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},x={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var C=require("nanostores");var ae=require("@better-fetch/fetch"),O=require("nanostores"),v=(e,t,r,s)=>{let n=(0,O.atom)({data:null,error:null,isPending:!0,isRefetching:!1}),f=()=>{let c=typeof s=="function"?s({data:n.get().data,error:n.get().error,isPending:n.get().isPending}):s;return r(t,{...c,async onSuccess(l){n.set({data:l.data,error:null,isPending:!1,isRefetching:!1}),await c?.onSuccess?.(l)},async onError(l){n.set({error:l.error,data:null,isPending:!1,isRefetching:!1}),await c?.onError?.(l)},async onRequest(l){let a=n.get();n.set({isPending:a.data===null,data:a.data,error:null,isRefetching:!0}),await c?.onRequest?.(l)}})};e=Array.isArray(e)?e:[e];let u=!1;for(let c of e)c.subscribe(()=>{u?f():(0,O.onMount)(n,()=>(f(),u=!0,()=>{n.off(),c.off()}))});return n};function L(e){let t=(0,C.atom)(!1);return{session:v(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var _=e=>{let t="credentials"in Request.prototype,r=F(e?.baseURL),s=e?.plugins?.flatMap(o=>o.fetchPlugins).filter(o=>o!==void 0)||[],n=(0,E.createFetch)({baseURL:r,...t?{credentials:"include"}:{},method:"GET",...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...s]:[w,x,...e?.fetchOptions?.plugins||[],...s]}),{$sessionSignal:f,session:u}=L(n),c=e?.plugins||[],l={},a={$sessionSignal:f,session:u},i={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST"},d=[{signal:"$sessionSignal",matcher(o){return o==="/sign-out"||o==="/update-user"||o.startsWith("/sign-in")||o.startsWith("/sign-up")}}];for(let o of c)o.getAtoms&&Object.assign(a,o.getAtoms?.(n)),o.pathMethods&&Object.assign(i,o.pathMethods),o.atomListeners&&d.push(...o.atomListeners);let m={notify:o=>{a[o].set(!a[o].get())},listen:(o,b)=>{a[o].subscribe(b)},atoms:a};for(let o of c)o.getActions&&Object.assign(l,o.getActions?.(n,m));return{pluginsActions:l,pluginsAtoms:a,pluginPathMethods:i,atomListeners:d,$fetch:n,$store:m}};function I(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Q(e,t,r){let s=t[e],{fetchOptions:n,query:f,...u}=r||{};return s||(n?.method?n.method:u&&Object.keys(u).length>0?"POST":"GET")}function $(e,t,r,s,n){function f(u=[]){return new Proxy(function(){},{get(c,l){let a=[...u,l],i=e;for(let d of a)if(i&&typeof i=="object"&&d in i)i=i[d];else{i=void 0;break}return typeof i=="function"?i:f(a)},apply:async(c,l,a)=>{let i="/"+u.map(R=>R.replace(/[A-Z]/g,y=>`-${y.toLowerCase()}`)).join("/"),d=a[0]||{},m=a[1]||{},{query:o,fetchOptions:b,...k}=d,h={...m,...b},B=Q(i,r,d);return await t(i,{...h,body:B==="GET"?void 0:{...k,...h?.body||{}},query:o||h?.query,method:B,async onSuccess(R){await h?.onSuccess?.(R);let y=n?.find(j=>j.matcher(i));if(!y)return;let T=s[y.signal];if(!T)return;let W=T.get();setTimeout(()=>{T.set(!W)},10)}})}})}return f()}function K(e){let{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:s,$fetch:n,atomListeners:f,$store:u}=_(e),c={};for(let[i,d]of Object.entries(s))c[`use${I(i)}`]=()=>d;let l={...r,...c,$fetch:n,$store:u};return $(l,n,t,s,f)}0&&(module.exports={createAuthClient});
