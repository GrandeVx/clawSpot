"use strict";var U=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var N=(e,t)=>{for(var n in t)U(e,n,{get:t[n],enumerable:!0})},z=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of G(t))!D.call(e,r)&&r!==n&&U(e,r,{get:()=>t[r],enumerable:!(s=M(t,r))||s.enumerable});return e};var X=e=>z(U({},"__esModule",{value:!0}),e);var te={};N(te,{createAuthClient:()=>ee});module.exports=X(te);var _=require("@better-fetch/fetch");var P=Object.create(null),g=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?P:globalThis),p=new Proxy(P,{get(e,t){return g()[t]??P[t]},has(e,t){let n=g();return t in n||t in P},set(e,t,n){let s=g(!0);return s[t]=n,!0},deleteProperty(e,t){if(!t)return!1;let n=g(!0);return delete n[t],!0},ownKeys(){let e=g(!0);return Object.keys(e)}});function K(e){return e?e!=="false":!1}var Q=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var re=Q==="test"||K(p.TEST);var A=class extends Error{constructor(t,n){super(t),this.name="BetterAuthError",this.message=t,this.cause=n,this.stack=""}};function Z(e){try{return new URL(e).pathname!=="/"}catch{throw new A(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function v(e,t="/api/auth"){return Z(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}function B(e,t){if(e)return v(e,t);let n=p.BETTER_AUTH_URL||p.NEXT_PUBLIC_BETTER_AUTH_URL||p.PUBLIC_BETTER_AUTH_URL||p.NUXT_PUBLIC_BETTER_AUTH_URL||p.NUXT_PUBLIC_AUTH_URL||(p.BASE_URL!=="/"?p.BASE_URL:void 0);if(n)return v(n,t);if(typeof window<"u"&&window.location)return v(window.location.origin,t)}var ye=require("nanostores");var le=require("@better-fetch/fetch"),F={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},w={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var L=require("nanostores");var fe=require("@better-fetch/fetch"),b=require("nanostores"),C=(e,t,n,s)=>{let r=(0,b.atom)({data:null,error:null,isPending:!0,isRefetching:!1}),f=()=>{let c=typeof s=="function"?s({data:r.get().data,error:r.get().error,isPending:r.get().isPending}):s;return n(t,{...c,async onSuccess(l){r.set({data:l.data,error:null,isPending:!1,isRefetching:!1}),await c?.onSuccess?.(l)},async onError(l){r.set({error:l.error,data:null,isPending:!1,isRefetching:!1}),await c?.onError?.(l)},async onRequest(l){let i=r.get();r.set({isPending:i.data===null,data:i.data,error:null,isRefetching:!0}),await c?.onRequest?.(l)}})};e=Array.isArray(e)?e:[e];let u=!1;for(let c of e)c.subscribe(()=>{u?f():(0,b.onMount)(r,()=>(f(),u=!0,()=>{r.off(),c.off()}))});return r};function E(e){let t=(0,L.atom)(!1);return{session:C(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var I=e=>{let t="credentials"in Request.prototype,n=B(e?.baseURL),s=e?.plugins?.flatMap(o=>o.fetchPlugins).filter(o=>o!==void 0)||[],r=(0,_.createFetch)({baseURL:n,...t?{credentials:"include"}:{},method:"GET",...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...s]:[F,w,...e?.fetchOptions?.plugins||[],...s]}),{$sessionSignal:f,session:u}=E(r),c=e?.plugins||[],l={},i={$sessionSignal:f,session:u},a={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST"},d=[{signal:"$sessionSignal",matcher(o){return o==="/sign-out"||o==="/update-user"||o.startsWith("/sign-in")||o.startsWith("/sign-up")}}];for(let o of c)o.getAtoms&&Object.assign(i,o.getAtoms?.(r)),o.pathMethods&&Object.assign(a,o.pathMethods),o.atomListeners&&d.push(...o.atomListeners);let m={notify:o=>{i[o].set(!i[o].get())},listen:(o,S)=>{i[o].subscribe(S)},atoms:i};for(let o of c)o.getActions&&Object.assign(l,o.getActions?.(r,m));return{pluginsActions:l,pluginsAtoms:i,pluginPathMethods:a,atomListeners:d,$fetch:r,$store:m}};function J(e,t,n){let s=t[e],{fetchOptions:r,query:f,...u}=n||{};return s||(r?.method?r.method:u&&Object.keys(u).length>0?"POST":"GET")}function k(e,t,n,s,r){function f(u=[]){return new Proxy(function(){},{get(c,l){let i=[...u,l],a=e;for(let d of i)if(a&&typeof a=="object"&&d in a)a=a[d];else{a=void 0;break}return typeof a=="function"?a:f(i)},apply:async(c,l,i)=>{let a="/"+u.map(R=>R.replace(/[A-Z]/g,y=>`-${y.toLowerCase()}`)).join("/"),d=i[0]||{},m=i[1]||{},{query:o,fetchOptions:S,...q}=d,h={...m,...S},x=J(a,n,d);return await t(a,{...h,body:x==="GET"?void 0:{...q,...h?.body||{}},query:o||h?.query,method:x,async onSuccess(R){await h?.onSuccess?.(R);let y=r?.find(V=>V.matcher(a));if(!y)return;let T=s[y.signal];if(!T)return;let H=T.get();setTimeout(()=>{T.set(!H)},10)}})}})}return f()}function $(e){return e.charAt(0).toUpperCase()+e.slice(1)}var O=require("solid-js/store"),j=require("solid-js");function W(e){let t=e.listen(()=>{}),[n,s]=(0,O.createStore)({value:e.get()}),r=e.subscribe(f=>{s("value",(0,O.reconcile)(f))});return(0,j.onCleanup)(()=>r()),t(),()=>n.value}function Y(e){return`use${$(e)}`}function ee(e){let{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:s,$fetch:r,atomListeners:f}=I(e),u={};for(let[i,a]of Object.entries(s))u[Y(i)]=()=>W(a);let c={...n,...u};return k(c,r,t,s,f)}0&&(module.exports={createAuthClient});
