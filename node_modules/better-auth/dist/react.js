import{createFetch as M}from"@better-fetch/fetch";var P=Object.create(null),g=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?P:globalThis),d=new Proxy(P,{get(e,t){return g()[t]??P[t]},has(e,t){let n=g();return t in n||t in P},set(e,t,n){let s=g(!0);return s[t]=n,!0},deleteProperty(e,t){if(!t)return!1;let n=g(!0);return delete n[t],!0},ownKeys(){let e=g(!0);return Object.keys(e)}});function $(e){return e?e!=="false":!1}var W=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var Z=W==="test"||$(d.TEST);var S=class extends Error{constructor(t,n){super(t),this.name="BetterAuthError",this.message=t,this.cause=n,this.stack=""}};function j(e){try{return new URL(e).pathname!=="/"}catch{throw new S(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function R(e,t="/api/auth"){return j(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}function x(e,t){if(e)return R(e,t);let n=d.BETTER_AUTH_URL||d.NEXT_PUBLIC_BETTER_AUTH_URL||d.PUBLIC_BETTER_AUTH_URL||d.NUXT_PUBLIC_BETTER_AUTH_URL||d.NUXT_PUBLIC_AUTH_URL||(d.BASE_URL!=="/"?d.BASE_URL:void 0);if(n)return R(n,t);if(typeof window<"u"&&window.location)return R(window.location.origin,t)}import"nanostores";import"@better-fetch/fetch";var B={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},v={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};import{atom as K}from"nanostores";import"@better-fetch/fetch";import{atom as q,onMount as H}from"nanostores";var w=(e,t,n,s)=>{let r=q({data:null,error:null,isPending:!0,isRefetching:!1}),f=()=>{let l=typeof s=="function"?s({data:r.get().data,error:r.get().error,isPending:r.get().isPending}):s;return n(t,{...l,async onSuccess(u){r.set({data:u.data,error:null,isPending:!1,isRefetching:!1}),await l?.onSuccess?.(u)},async onError(u){r.set({error:u.error,data:null,isPending:!1,isRefetching:!1}),await l?.onError?.(u)},async onRequest(u){let a=r.get();r.set({isPending:a.data===null,data:a.data,error:null,isRefetching:!0}),await l?.onRequest?.(u)}})};e=Array.isArray(e)?e:[e];let c=!1;for(let l of e)l.subscribe(()=>{c?f():H(r,()=>(f(),c=!0,()=>{r.off(),l.off()}))});return r};function F(e){let t=K(!1);return{session:w(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var C=e=>{let t="credentials"in Request.prototype,n=x(e?.baseURL),s=e?.plugins?.flatMap(o=>o.fetchPlugins).filter(o=>o!==void 0)||[],r=M({baseURL:n,...t?{credentials:"include"}:{},method:"GET",...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...s]:[B,v,...e?.fetchOptions?.plugins||[],...s]}),{$sessionSignal:f,session:c}=F(r),l=e?.plugins||[],u={},a={$sessionSignal:f,session:c},i={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST"},p=[{signal:"$sessionSignal",matcher(o){return o==="/sign-out"||o==="/update-user"||o.startsWith("/sign-in")||o.startsWith("/sign-up")}}];for(let o of l)o.getAtoms&&Object.assign(a,o.getAtoms?.(r)),o.pathMethods&&Object.assign(i,o.pathMethods),o.atomListeners&&p.push(...o.atomListeners);let m={notify:o=>{a[o].set(!a[o].get())},listen:(o,O)=>{a[o].subscribe(O)},atoms:a};for(let o of l)o.getActions&&Object.assign(u,o.getActions?.(r,m));return{pluginsActions:u,pluginsAtoms:a,pluginPathMethods:i,atomListeners:p,$fetch:r,$store:m}};function V(e,t,n){let s=t[e],{fetchOptions:r,query:f,...c}=n||{};return s||(r?.method?r.method:c&&Object.keys(c).length>0?"POST":"GET")}function L(e,t,n,s,r){function f(c=[]){return new Proxy(function(){},{get(l,u){let a=[...c,u],i=e;for(let p of a)if(i&&typeof i=="object"&&p in i)i=i[p];else{i=void 0;break}return typeof i=="function"?i:f(a)},apply:async(l,u,a)=>{let i="/"+c.map(A=>A.replace(/[A-Z]/g,h=>`-${h.toLowerCase()}`)).join("/"),p=a[0]||{},m=a[1]||{},{query:o,fetchOptions:O,..._}=p,y={...m,...O},U=V(i,n,p);return await t(i,{...y,body:U==="GET"?void 0:{..._,...y?.body||{}},query:o||y?.query,method:U,async onSuccess(A){await y?.onSuccess?.(A);let h=r?.find(I=>I.matcher(i));if(!h)return;let b=s[h.signal];if(!b)return;let k=b.get();setTimeout(()=>{b.set(!k)},10)}})}})}return f()}import{listenKeys as D}from"nanostores";import{useCallback as G,useRef as N,useSyncExternalStore as z}from"react";var E=(e,t)=>n=>{e.current=n,t()};function T(e,{keys:t,deps:n=[e,t]}={}){let s=N();s.current=e.get();let r=G(c=>(t?.length||0)>0?D(e,t,E(s,c)):e.listen(E(s,c)),n),f=()=>s.current;return z(r,f,f)}function Q(e){return`use${X(e)}`}function X(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Ue(e){let{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:s,$fetch:r,$store:f,atomListeners:c}=C(e),l={};for(let[i,p]of Object.entries(s))l[Q(i)]=()=>T(p);let u={...n,...l,$fetch:r,$store:f};return L(u,r,t,s,c)}var xe=T;export{X as capitalizeFirstLetter,Ue as createAuthClient,xe as useAuthQuery};
