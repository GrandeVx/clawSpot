import{cookies as A}from"next/headers";import{TimeSpan as V}from"oslo";import{base64url as M}from"oslo/encoding";import{HMAC as v,sha256 as E}from"oslo/crypto";var m=Object.create(null),a=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?m:globalThis),x=new Proxy(m,{get(e,t){return a()[t]??m[t]},has(e,t){let o=a();return t in o||t in m},set(e,t,o){let i=a(!0);return i[t]=o,!0},deleteProperty(e,t){if(!t)return!1;let o=a(!0);return delete o[t],!0},ownKeys(){let e=a(!0);return Object.keys(e)}});function C(e){return e?e!=="false":!1}var y=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var _=y==="test"||C(x.TEST);function l(e){let t=new Map;return e.split(", ").forEach(i=>{let d=i.split(";").map(f=>f.trim()),[s,...c]=d,[u,...h]=s.split("="),p=h.join("=");if(!u||p===void 0){console.warn(`Malformed cookie: ${i}`);return}let r={value:p};c.forEach(f=>{let[g,...b]=f.split("="),n=b.join("="),k=g.trim().toLowerCase();switch(k){case"max-age":r["max-age"]=n?parseInt(n.trim(),10):void 0;break;case"expires":r.expires=n?new Date(n.trim()):void 0;break;case"domain":r.domain=n?n.trim():void 0;break;case"path":r.path=n?n.trim():void 0;break;case"secure":r.secure=!0;break;case"httponly":r.httponly=!0;break;case"samesite":r.samesite=n?n.trim().toLowerCase():void 0;break;default:r[k]=n?n.trim():!0;break}}),t.set(u,r)}),t}function X(e){let t=async o=>"handler"in e?e.handler(o):e(o);return{GET:t,POST:t}}var Y=()=>({id:"next-cookies",hooks:{after:[{matcher(e){return!0},handler:async e=>{let t=e.responseHeader;if(t instanceof Headers){let o=t?.get("set-cookie");if(!o)return;let i=l(o),d=await A();i.forEach((s,c)=>{if(!c)return;let u={sameSite:s.samesite,secure:s.secure,maxAge:s["max-age"],httpOnly:s.httponly,domain:s.domain,path:s.path};try{d.set(c,decodeURIComponent(s.value),u)}catch{if(process.env.NODE_ENV!=="development")return}});return}}}]}});export{Y as nextCookies,X as toNextJsHandler};
