"use strict";var U=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var N=(e,t)=>{for(var n in t)U(e,n,{get:t[n],enumerable:!0})},z=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of D(t))!G.call(e,r)&&r!==n&&U(e,r,{get:()=>t[r],enumerable:!(s=V(t,r))||s.enumerable});return e};var Q=e=>z(U({},"__esModule",{value:!0}),e);var re={};N(re,{capitalizeFirstLetter:()=>q,createAuthClient:()=>te,useAuthQuery:()=>ne});module.exports=Q(re);var k=require("@better-fetch/fetch");var S=Object.create(null),m=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?S:globalThis),d=new Proxy(S,{get(e,t){return m()[t]??S[t]},has(e,t){let n=m();return t in n||t in S},set(e,t,n){let s=m(!0);return s[t]=n,!0},deleteProperty(e,t){if(!t)return!1;let n=m(!0);return delete n[t],!0},ownKeys(){let e=m(!0);return Object.keys(e)}});function X(e){return e?e!=="false":!1}var Z=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var se=Z==="test"||X(d.TEST);var O=class extends Error{constructor(t,n){super(t),this.name="BetterAuthError",this.message=t,this.cause=n,this.stack=""}};function J(e){try{return new URL(e).pathname!=="/"}catch{throw new O(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function x(e,t="/api/auth"){return J(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}function w(e,t){if(e)return x(e,t);let n=d.BETTER_AUTH_URL||d.NEXT_PUBLIC_BETTER_AUTH_URL||d.PUBLIC_BETTER_AUTH_URL||d.NUXT_PUBLIC_BETTER_AUTH_URL||d.NUXT_PUBLIC_AUTH_URL||(d.BASE_URL!=="/"?d.BASE_URL:void 0);if(n)return x(n,t);if(typeof window<"u"&&window.location)return x(window.location.origin,t)}var Se=require("nanostores");var fe=require("@better-fetch/fetch"),F={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},C={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var E=require("nanostores");var de=require("@better-fetch/fetch"),A=require("nanostores"),L=(e,t,n,s)=>{let r=(0,A.atom)({data:null,error:null,isPending:!0,isRefetching:!1}),f=()=>{let l=typeof s=="function"?s({data:r.get().data,error:r.get().error,isPending:r.get().isPending}):s;return n(t,{...l,async onSuccess(u){r.set({data:u.data,error:null,isPending:!1,isRefetching:!1}),await l?.onSuccess?.(u)},async onError(u){r.set({error:u.error,data:null,isPending:!1,isRefetching:!1}),await l?.onError?.(u)},async onRequest(u){let a=r.get();r.set({isPending:a.data===null,data:a.data,error:null,isRefetching:!0}),await l?.onRequest?.(u)}})};e=Array.isArray(e)?e:[e];let c=!1;for(let l of e)l.subscribe(()=>{c?f():(0,A.onMount)(r,()=>(f(),c=!0,()=>{r.off(),l.off()}))});return r};function _(e){let t=(0,E.atom)(!1);return{session:L(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var I=e=>{let t="credentials"in Request.prototype,n=w(e?.baseURL),s=e?.plugins?.flatMap(o=>o.fetchPlugins).filter(o=>o!==void 0)||[],r=(0,k.createFetch)({baseURL:n,...t?{credentials:"include"}:{},method:"GET",...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...s]:[F,C,...e?.fetchOptions?.plugins||[],...s]}),{$sessionSignal:f,session:c}=_(r),l=e?.plugins||[],u={},a={$sessionSignal:f,session:c},i={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST"},p=[{signal:"$sessionSignal",matcher(o){return o==="/sign-out"||o==="/update-user"||o.startsWith("/sign-in")||o.startsWith("/sign-up")}}];for(let o of l)o.getAtoms&&Object.assign(a,o.getAtoms?.(r)),o.pathMethods&&Object.assign(i,o.pathMethods),o.atomListeners&&p.push(...o.atomListeners);let y={notify:o=>{a[o].set(!a[o].get())},listen:(o,b)=>{a[o].subscribe(b)},atoms:a};for(let o of l)o.getActions&&Object.assign(u,o.getActions?.(r,y));return{pluginsActions:u,pluginsAtoms:a,pluginPathMethods:i,atomListeners:p,$fetch:r,$store:y}};function Y(e,t,n){let s=t[e],{fetchOptions:r,query:f,...c}=n||{};return s||(r?.method?r.method:c&&Object.keys(c).length>0?"POST":"GET")}function $(e,t,n,s,r){function f(c=[]){return new Proxy(function(){},{get(l,u){let a=[...c,u],i=e;for(let p of a)if(i&&typeof i=="object"&&p in i)i=i[p];else{i=void 0;break}return typeof i=="function"?i:f(a)},apply:async(l,u,a)=>{let i="/"+c.map(R=>R.replace(/[A-Z]/g,P=>`-${P.toLowerCase()}`)).join("/"),p=a[0]||{},y=a[1]||{},{query:o,fetchOptions:b,...H}=p,h={...y,...b},v=Y(i,n,p);return await t(i,{...h,body:v==="GET"?void 0:{...H,...h?.body||{}},query:o||h?.query,method:v,async onSuccess(R){await h?.onSuccess?.(R);let P=r?.find(M=>M.matcher(i));if(!P)return;let T=s[P.signal];if(!T)return;let K=T.get();setTimeout(()=>{T.set(!K)},10)}})}})}return f()}var j=require("nanostores"),g=require("react"),W=(e,t)=>n=>{e.current=n,t()};function B(e,{keys:t,deps:n=[e,t]}={}){let s=(0,g.useRef)();s.current=e.get();let r=(0,g.useCallback)(c=>(t?.length||0)>0?(0,j.listenKeys)(e,t,W(s,c)):e.listen(W(s,c)),n),f=()=>s.current;return(0,g.useSyncExternalStore)(r,f,f)}function ee(e){return`use${q(e)}`}function q(e){return e.charAt(0).toUpperCase()+e.slice(1)}function te(e){let{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:s,$fetch:r,$store:f,atomListeners:c}=I(e),l={};for(let[i,p]of Object.entries(s))l[ee(i)]=()=>B(p);let u={...n,...l,$fetch:r,$store:f};return $(u,r,t,s,c)}var ne=B;0&&(module.exports={capitalizeFirstLetter,createAuthClient,useAuthQuery});
